/* deamon.c generated by valac 0.12.0, the Vala compiler
 * generated from deamon.vala, do not modify */

/* 
Copyright (c) 2011 by Simon Schneegans

This program is free software: you can redistribute it and/or modify it
under the terms of the GNU General Public License as published by the Free
Software Foundation, either version 3 of the License, or (at your option)
any later version.

This program is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
more details.

You should have received a copy of the GNU General Public License along with
this program.  If not, see <http://www.gnu.org/licenses/>. 
*/

#include <glib.h>
#include <glib-object.h>
#include <libappindicator/app-indicator.h>
#include <gtk/gtk.h>
#include <float.h>
#include <math.h>
#include <stdlib.h>
#include <string.h>
#include <gdk/gdk.h>


#define GNOME_PIE_TYPE_DEAMON (gnome_pie_deamon_get_type ())
#define GNOME_PIE_DEAMON(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), GNOME_PIE_TYPE_DEAMON, GnomePieDeamon))
#define GNOME_PIE_DEAMON_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), GNOME_PIE_TYPE_DEAMON, GnomePieDeamonClass))
#define GNOME_PIE_IS_DEAMON(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), GNOME_PIE_TYPE_DEAMON))
#define GNOME_PIE_IS_DEAMON_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), GNOME_PIE_TYPE_DEAMON))
#define GNOME_PIE_DEAMON_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), GNOME_PIE_TYPE_DEAMON, GnomePieDeamonClass))

typedef struct _GnomePieDeamon GnomePieDeamon;
typedef struct _GnomePieDeamonClass GnomePieDeamonClass;
typedef struct _GnomePieDeamonPrivate GnomePieDeamonPrivate;

#define GNOME_PIE_TYPE_KEYBINDING_MANAGER (gnome_pie_keybinding_manager_get_type ())
#define GNOME_PIE_KEYBINDING_MANAGER(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), GNOME_PIE_TYPE_KEYBINDING_MANAGER, GnomePieKeybindingManager))
#define GNOME_PIE_KEYBINDING_MANAGER_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), GNOME_PIE_TYPE_KEYBINDING_MANAGER, GnomePieKeybindingManagerClass))
#define GNOME_PIE_IS_KEYBINDING_MANAGER(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), GNOME_PIE_TYPE_KEYBINDING_MANAGER))
#define GNOME_PIE_IS_KEYBINDING_MANAGER_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), GNOME_PIE_TYPE_KEYBINDING_MANAGER))
#define GNOME_PIE_KEYBINDING_MANAGER_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), GNOME_PIE_TYPE_KEYBINDING_MANAGER, GnomePieKeybindingManagerClass))

typedef struct _GnomePieKeybindingManager GnomePieKeybindingManager;
typedef struct _GnomePieKeybindingManagerClass GnomePieKeybindingManagerClass;

#define GNOME_PIE_TYPE_RING (gnome_pie_ring_get_type ())
#define GNOME_PIE_RING(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), GNOME_PIE_TYPE_RING, GnomePieRing))
#define GNOME_PIE_RING_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), GNOME_PIE_TYPE_RING, GnomePieRingClass))
#define GNOME_PIE_IS_RING(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), GNOME_PIE_TYPE_RING))
#define GNOME_PIE_IS_RING_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), GNOME_PIE_TYPE_RING))
#define GNOME_PIE_RING_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), GNOME_PIE_TYPE_RING, GnomePieRingClass))

typedef struct _GnomePieRing GnomePieRing;
typedef struct _GnomePieRingClass GnomePieRingClass;
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))

#define GNOME_PIE_TYPE_GNOME_PIE_ABOUT_DIALOG (gnome_pie_gnome_pie_about_dialog_get_type ())
#define GNOME_PIE_GNOME_PIE_ABOUT_DIALOG(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), GNOME_PIE_TYPE_GNOME_PIE_ABOUT_DIALOG, GnomePieGnomePieAboutDialog))
#define GNOME_PIE_GNOME_PIE_ABOUT_DIALOG_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), GNOME_PIE_TYPE_GNOME_PIE_ABOUT_DIALOG, GnomePieGnomePieAboutDialogClass))
#define GNOME_PIE_IS_GNOME_PIE_ABOUT_DIALOG(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), GNOME_PIE_TYPE_GNOME_PIE_ABOUT_DIALOG))
#define GNOME_PIE_IS_GNOME_PIE_ABOUT_DIALOG_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), GNOME_PIE_TYPE_GNOME_PIE_ABOUT_DIALOG))
#define GNOME_PIE_GNOME_PIE_ABOUT_DIALOG_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), GNOME_PIE_TYPE_GNOME_PIE_ABOUT_DIALOG, GnomePieGnomePieAboutDialogClass))

typedef struct _GnomePieGnomePieAboutDialog GnomePieGnomePieAboutDialog;
typedef struct _GnomePieGnomePieAboutDialogClass GnomePieGnomePieAboutDialogClass;

struct _GnomePieDeamon {
	GObject parent_instance;
	GnomePieDeamonPrivate * priv;
};

struct _GnomePieDeamonClass {
	GObjectClass parent_class;
};

struct _GnomePieDeamonPrivate {
	GnomePieKeybindingManager* keys_;
	AppIndicator* _indicator;
	GnomePieRing* ring_;
};

typedef void (*GnomePieKeybindingManagerKeybindingHandlerFunc) (GdkEvent* event, void* user_data);

static gpointer gnome_pie_deamon_parent_class = NULL;
extern gdouble gnome_pie_utils_refresh_rate;

GType gnome_pie_deamon_get_type (void) G_GNUC_CONST;
GType gnome_pie_keybinding_manager_get_type (void) G_GNUC_CONST;
GType gnome_pie_ring_get_type (void) G_GNUC_CONST;
#define GNOME_PIE_DEAMON_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), GNOME_PIE_TYPE_DEAMON, GnomePieDeamonPrivate))
enum  {
	GNOME_PIE_DEAMON_DUMMY_PROPERTY
};
static void gnome_pie_deamon_showRing (GnomePieDeamon* self);
void gnome_pie_utils_present_window (GtkWindow* window);
static gboolean _lambda2_ (GnomePieDeamon* self);
static gboolean __lambda2__gsource_func (gpointer self);
GnomePieDeamon* gnome_pie_deamon_new (void);
GnomePieDeamon* gnome_pie_deamon_construct (GType object_type);
GnomePieRing* gnome_pie_ring_new (void);
GnomePieRing* gnome_pie_ring_construct (GType object_type);
GnomePieKeybindingManager* gnome_pie_keybinding_manager_new (void);
GnomePieKeybindingManager* gnome_pie_keybinding_manager_construct (GType object_type);
void gnome_pie_keybinding_manager_bind (GnomePieKeybindingManager* self, const gchar* accelerator, GnomePieKeybindingManagerKeybindingHandlerFunc handler, void* handler_target);
static void _gnome_pie_deamon_showRing_gnome_pie_keybinding_manager_keybinding_handler_func (GdkEvent* event, gpointer self);
static void _lambda3_ (GnomePieDeamon* self);
static void __lambda3__gtk_menu_item_activate (GtkMenuItem* _sender, gpointer self);
static void _lambda4_ (GnomePieDeamon* self);
GnomePieGnomePieAboutDialog* gnome_pie_gnome_pie_about_dialog_new (void);
GnomePieGnomePieAboutDialog* gnome_pie_gnome_pie_about_dialog_construct (GType object_type);
GType gnome_pie_gnome_pie_about_dialog_get_type (void) G_GNUC_CONST;
static void __lambda4__gtk_menu_item_activate (GtkMenuItem* _sender, gpointer self);
static void _gtk_main_quit_gtk_menu_item_activate (GtkMenuItem* _sender, gpointer self);
void gnome_pie_deamon_run (GnomePieDeamon* self);
static void gnome_pie_deamon_finalize (GObject* obj);


static gboolean _lambda2_ (GnomePieDeamon* self) {
	gboolean result = FALSE;
	gtk_widget_queue_draw ((GtkWidget*) self->priv->ring_);
	result = TRUE;
	return result;
}


static gboolean __lambda2__gsource_func (gpointer self) {
	gboolean result;
	result = _lambda2_ (self);
	return result;
}


static void gnome_pie_deamon_showRing (GnomePieDeamon* self) {
	g_return_if_fail (self != NULL);
	gtk_widget_show ((GtkWidget*) self->priv->ring_);
	gnome_pie_utils_present_window ((GtkWindow*) self->priv->ring_);
	g_timeout_add_full (G_PRIORITY_DEFAULT, (guint) (1000.0 / gnome_pie_utils_refresh_rate), __lambda2__gsource_func, g_object_ref (self), g_object_unref);
}


static void _gnome_pie_deamon_showRing_gnome_pie_keybinding_manager_keybinding_handler_func (GdkEvent* event, gpointer self) {
	gnome_pie_deamon_showRing (self);
}


static void _lambda3_ (GnomePieDeamon* self) {
}


static void __lambda3__gtk_menu_item_activate (GtkMenuItem* _sender, gpointer self) {
	_lambda3_ (self);
}


static void _lambda4_ (GnomePieDeamon* self) {
	GnomePieGnomePieAboutDialog* _tmp0_ = NULL;
	GnomePieGnomePieAboutDialog* about;
	_tmp0_ = gnome_pie_gnome_pie_about_dialog_new ();
	about = g_object_ref_sink (_tmp0_);
	gtk_dialog_run ((GtkDialog*) about);
	gtk_object_destroy ((GtkObject*) about);
	_g_object_unref0 (about);
}


static void __lambda4__gtk_menu_item_activate (GtkMenuItem* _sender, gpointer self) {
	_lambda4_ (self);
}


static void _gtk_main_quit_gtk_menu_item_activate (GtkMenuItem* _sender, gpointer self) {
	gtk_main_quit ();
}


GnomePieDeamon* gnome_pie_deamon_construct (GType object_type) {
	GnomePieDeamon * self = NULL;
	GnomePieRing* _tmp0_ = NULL;
	GnomePieKeybindingManager* _tmp1_ = NULL;
	AppIndicator* _tmp2_ = NULL;
	GtkMenu* _tmp3_ = NULL;
	GtkMenu* menu;
	GtkImageMenuItem* _tmp4_ = NULL;
	GtkImageMenuItem* item;
	GtkImageMenuItem* _tmp5_ = NULL;
	GtkSeparatorMenuItem* _tmp6_ = NULL;
	GtkSeparatorMenuItem* sepa;
	GtkImageMenuItem* _tmp7_ = NULL;
	self = (GnomePieDeamon*) g_object_new (object_type, NULL);
	_tmp0_ = gnome_pie_ring_new ();
	_g_object_unref0 (self->priv->ring_);
	self->priv->ring_ = g_object_ref_sink (_tmp0_);
	_tmp1_ = gnome_pie_keybinding_manager_new ();
	_g_object_unref0 (self->priv->keys_);
	self->priv->keys_ = _tmp1_;
	gnome_pie_keybinding_manager_bind (self->priv->keys_, "<Alt>V", _gnome_pie_deamon_showRing_gnome_pie_keybinding_manager_keybinding_handler_func, self);
	_tmp2_ = app_indicator_new ("Gnome-Pie", "gnome-do-icon", APP_INDICATOR_CATEGORY_APPLICATION_STATUS);
	_g_object_unref0 (self->priv->_indicator);
	self->priv->_indicator = _tmp2_;
	app_indicator_set_status (self->priv->_indicator, APP_INDICATOR_STATUS_ACTIVE);
	_tmp3_ = (GtkMenu*) gtk_menu_new ();
	menu = g_object_ref_sink (_tmp3_);
	_tmp4_ = (GtkImageMenuItem*) gtk_image_menu_item_new_from_stock (GTK_STOCK_PREFERENCES, NULL);
	item = g_object_ref_sink (_tmp4_);
	g_signal_connect_object ((GtkMenuItem*) item, "activate", (GCallback) __lambda3__gtk_menu_item_activate, self, 0);
	gtk_widget_show ((GtkWidget*) item);
	gtk_menu_shell_append ((GtkMenuShell*) menu, (GtkWidget*) ((GtkMenuItem*) item));
	_tmp5_ = (GtkImageMenuItem*) gtk_image_menu_item_new_from_stock (GTK_STOCK_ABOUT, NULL);
	_g_object_unref0 (item);
	item = g_object_ref_sink (_tmp5_);
	gtk_widget_show ((GtkWidget*) item);
	g_signal_connect_object ((GtkMenuItem*) item, "activate", (GCallback) __lambda4__gtk_menu_item_activate, self, 0);
	gtk_menu_shell_append ((GtkMenuShell*) menu, (GtkWidget*) ((GtkMenuItem*) item));
	_tmp6_ = (GtkSeparatorMenuItem*) gtk_separator_menu_item_new ();
	sepa = g_object_ref_sink (_tmp6_);
	gtk_widget_show ((GtkWidget*) sepa);
	gtk_menu_shell_append ((GtkMenuShell*) menu, (GtkWidget*) ((GtkMenuItem*) sepa));
	_tmp7_ = (GtkImageMenuItem*) gtk_image_menu_item_new_from_stock (GTK_STOCK_QUIT, NULL);
	_g_object_unref0 (item);
	item = g_object_ref_sink (_tmp7_);
	g_signal_connect ((GtkMenuItem*) item, "activate", (GCallback) _gtk_main_quit_gtk_menu_item_activate, NULL);
	gtk_widget_show ((GtkWidget*) item);
	gtk_menu_shell_append ((GtkMenuShell*) menu, (GtkWidget*) ((GtkMenuItem*) item));
	app_indicator_set_menu (self->priv->_indicator, menu);
	_g_object_unref0 (sepa);
	_g_object_unref0 (item);
	_g_object_unref0 (menu);
	return self;
}


GnomePieDeamon* gnome_pie_deamon_new (void) {
	return gnome_pie_deamon_construct (GNOME_PIE_TYPE_DEAMON);
}


void gnome_pie_deamon_run (GnomePieDeamon* self) {
	g_return_if_fail (self != NULL);
	gtk_main ();
}


static void gnome_pie_deamon_class_init (GnomePieDeamonClass * klass) {
	gnome_pie_deamon_parent_class = g_type_class_peek_parent (klass);
	g_type_class_add_private (klass, sizeof (GnomePieDeamonPrivate));
	G_OBJECT_CLASS (klass)->finalize = gnome_pie_deamon_finalize;
}


static void gnome_pie_deamon_instance_init (GnomePieDeamon * self) {
	self->priv = GNOME_PIE_DEAMON_GET_PRIVATE (self);
}


static void gnome_pie_deamon_finalize (GObject* obj) {
	GnomePieDeamon * self;
	self = GNOME_PIE_DEAMON (obj);
	_g_object_unref0 (self->priv->keys_);
	_g_object_unref0 (self->priv->_indicator);
	_g_object_unref0 (self->priv->ring_);
	G_OBJECT_CLASS (gnome_pie_deamon_parent_class)->finalize (obj);
}


GType gnome_pie_deamon_get_type (void) {
	static volatile gsize gnome_pie_deamon_type_id__volatile = 0;
	if (g_once_init_enter (&gnome_pie_deamon_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (GnomePieDeamonClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) gnome_pie_deamon_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (GnomePieDeamon), 0, (GInstanceInitFunc) gnome_pie_deamon_instance_init, NULL };
		GType gnome_pie_deamon_type_id;
		gnome_pie_deamon_type_id = g_type_register_static (G_TYPE_OBJECT, "GnomePieDeamon", &g_define_type_info, 0);
		g_once_init_leave (&gnome_pie_deamon_type_id__volatile, gnome_pie_deamon_type_id);
	}
	return gnome_pie_deamon_type_id__volatile;
}



